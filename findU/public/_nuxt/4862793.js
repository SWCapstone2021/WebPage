(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{591:function(e,t,n){"use strict";n.r(t);n(7),n(37),n(72),n(170);var r={name:"Manager",layout:"DashboardLayout",data:function(){return{dialog:!1,dialogDelete:!1,editedIndex:-1,editedItem:{name:"",calories:0,fat:0,carbs:0,protein:0},defaultItem:{name:"",calories:0,fat:0,carbs:0,protein:0},headers:[{text:"Email",align:"start",value:"email"},{text:"msg",value:"unread_msg"},{text:"display name",value:"displayName"},{text:"created",value:"created"},{text:"membership",value:"membership"},{text:"manager",value:"manager"},{text:"Actions",value:"actions",sortable:!1}],userData:[],search:"",selected:[],expanded:[],singleExpand:!0,snack:!1,snackColor:"",snackText:"",max25chars:function(e){return e.length<=25||"Input too long!"}}},computed:{isManager:function(){return null!==this.$store.state.userData&&void 0!==this.$store.state.userData&&void 0!==this.$store.state.userData.manager&&this.$store.state.userData.manager}},watch:{dialog:function(e){e||this.close()},dialogDelete:function(e){e||this.closeDelete()},expanded:function(e,t){t.length>0&&this.$fire.firestore.collection("user").doc(t[0].email).update({unread_msg:0})}},mounted:function(){this.isManager||this.$router.push("/profile/account"),this.getUserData()},methods:{flipManager:function(e){this.$fire.firestore.collection("user").doc(e.email).update({manager:e.manager})},getColor:function(e){return"PRO"===e?"green":"grey"},getUserData:function(){var e=this;this.$fire.firestore.collection("user").onSnapshot((function(t){var n=[];t.forEach((function(t){var r=t.data();r.email=t.id,r.created=e.getDate(r.creationTime),n.push(r)})),e.userData=n}))},getDate:function(e){var t=new Date(parseInt(e));console.log(t);var dd=t.getDate(),n=t.getMonth()+1;return t.getFullYear()+"-"+n+"-"+dd},getStr:function(e){if(void 0!==e){var t=e[0],n=parseInt(t.split("_")[2]),r=new Date(n);return console.log(r.toLocaleDateString()),r}return""},timeStamp:function(e){return void 0!==e?(console.log(e),new Date(e.seconds)):""},editItem:function(e){var t=this;this.editedItem=[],void 0!==e.payment_id?this.$fire.firestore.collection("payment").where("id","in",e.payment_id).get().then((function(e){e.forEach((function(e){console.log(e.id," => ",e.data()),t.editedItem.push(e.data())}))})).catch((function(e){console.log("Error getting documents: ",e)})):this.editedItem.push({payment_date:"no subscription"}),this.dialog=!0},deleteItem:function(e){var t=this;this.editedIndex=this.userData.indexOf(e),this.editedItem=Object.assign({},e),this.$dialog.confirm({text:"Do you really want to delete account?",title:"Please confirm to continue"}).then((function(dialog){dialog&&t.$fire.functions.httpsCallable("deleteAccount")({user:t.editedItem}).then((function(e){console.log("deleteAccount",e)}))})).catch((function(e){console.log("Clicked on cancel"),console.log(e)}))},deleteItemConfirm:function(){this.userData.splice(this.editedIndex,1),this.closeDelete()},close:function(){this.dialog=!1},closeDelete:function(){var e=this;this.dialogDelete=!1,this.$nextTick((function(){e.editedItem=Object.assign({},e.defaultItem),e.editedIndex=-1}))},save:function(){this.editedIndex>-1?Object.assign(this.userData[this.editedIndex],this.editedItem):this.userData.push(this.editedItem),this.close()},saveSnack:function(e){this.$fire.firestore.collection("user").doc(e.email).update({displayName:e.displayName}),this.$fire.functions.httpsCallable("updateDisplayName")({email:e.email,displayName:e.displayName}).then((function(e){console.log("updateDisplayName",e)})),this.snack=!0,this.snackColor="success",this.snackText="Data saved"},cancelSnack:function(){this.snack=!0,this.snackColor="error",this.snackText="Canceled"},openSnack:function(){this.snack=!0,this.snackColor="info",this.snackText="Dialog opened"},closeSnack:function(){console.log("Dialog closed")}}},o=n(43),c=n(50),l=n.n(c),d=n(104),m=n(106),h=n(51),f=n(487),v=n(577),_=n(430),k=n(576),x=n(127),y=n(504),D=n(432),I=n(429),S=n(428),component=Object(o.a)(r,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-card",[n("v-card-title",[e._v("\n      User Manage\n      "),n("v-spacer"),e._v(" "),n("v-text-field",{attrs:{"append-icon":"mdi-magnify",label:"Search","single-line":"","hide-details":""},model:{value:e.search,callback:function(t){e.search=t},expression:"search"}})],1),e._v(" "),n("v-data-table",{staticClass:"elevation-1",attrs:{headers:e.headers,items:e.userData,"items-per-page":15,"sort-by":"created",search:e.search,"show-select":"","item-key":"email","show-expand":"",expanded:e.expanded,"single-expand":e.singleExpand},on:{"update:expanded":function(t){e.expanded=t}},scopedSlots:e._u([{key:"item.email",fn:function(t){var r=t.item;return[n("v-chip",{attrs:{color:"primary",dark:""}},[e._v("\n          "+e._s(r.email)+"\n        ")])]}},{key:"item.unread_msg",fn:function(t){var r=t.item;return[0!==r.unread_msg?n("v-chip",{attrs:{color:"deep-purple accent-4",dark:""}},[e._v("\n          "+e._s(r.unread_msg)+"\n        ")]):e._e(),e._v(" "),0===r.unread_msg?n("v-chip",{attrs:{color:"grey",dark:""}},[e._v("\n          "+e._s(r.unread_msg)+"\n        ")]):e._e()]}},{key:"item.displayName",fn:function(t){return[n("v-edit-dialog",{attrs:{"return-value":t.item.displayName},on:{"update:returnValue":function(n){return e.$set(t.item,"displayName",n)},"update:return-value":function(n){return e.$set(t.item,"displayName",n)},save:function(n){return e.saveSnack(t.item)},cancel:e.cancelSnack,open:e.openSnack,close:e.closeSnack},scopedSlots:e._u([{key:"input",fn:function(){return[n("v-text-field",{attrs:{rules:[e.max25chars],label:"Edit","single-line":"",counter:""},model:{value:t.item.displayName,callback:function(n){e.$set(t.item,"displayName",n)},expression:"props.item.displayName"}})]},proxy:!0}],null,!0)},[e._v("\n          "+e._s(t.item.displayName)+"\n          ")])]}},{key:"item.membership",fn:function(t){var r=t.item;return[n("v-chip",{attrs:{color:e.getColor(r.membership),dark:""}},[e._v("\n          "+e._s(r.membership)+"\n        ")])]}},{key:"item.manager",fn:function(t){var r=t.item;return[n("v-simple-checkbox",{on:{click:function(t){return e.flipManager(r)}},model:{value:r.manager,callback:function(t){e.$set(r,"manager",t)},expression:"item.manager"}})]}},{key:"item.actions",fn:function(t){var r=t.item;return[n("v-icon",{staticClass:"mr-2",attrs:{small:""},on:{click:function(t){return e.editItem(r)}}},[e._v("\n          mdi-attachment\n        ")]),e._v(" "),n("v-icon",{attrs:{small:""},on:{click:function(t){return e.deleteItem(r)}}},[e._v(" mdi-delete ")])]}},{key:"expanded-item",fn:function(t){var r=t.headers,o=t.item;return[0!==o.unread_msg?n("td",{attrs:{colspan:r.length}},[e._v("\n          Subscription Payment Info "+e._s(o.email)+" "),n("br"),e._v("\n          FindU schedule "+e._s(o.unread_msg)+" new payment for this user.\n          "),n("br"),e._v("\n          The card user use is "+e._s(o.card_name)+" "),n("br"),e._v("\n          "+e._s(e.getStr(o.payment_id[0]))+"\n        ")]):e._e()]}}]),model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}})],1),e._v(" "),n("v-dialog",{attrs:{"max-width":"600px"},model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[n("v-card",[n("v-card-title",[e._v(" subscription payment ")]),e._v(" "),e._l(e.editedItem,(function(t,r){return n("v-card",{key:r},[n("v-card-subtitle",[e._v(e._s(t.payment_date))]),e._v(" "),n("v-card-text",[e._v("\n          current status : "+e._s(t.status)+" "),n("br"),e._v("\n          amount : "+e._s(t.amount)+" "),n("br"),e._v("\n          Subscription Payment Info "+e._s(t.email)+" "),n("br"),e._v("\n          FindU schedule this payment at "+e._s(e.timeStamp(t.order_date))+"\n          "),n("br"),e._v("\n          The card user use is "+e._s(t.card_name)+"\n        ")])],1)}))],2)],1),e._v(" "),n("v-snackbar",{attrs:{timeout:3e3,color:e.snackColor},scopedSlots:e._u([{key:"action",fn:function(t){var r=t.attrs;return[n("v-btn",e._b({attrs:{text:""},on:{click:function(t){e.snack=!1}}},"v-btn",r,!1),[e._v(" Close ")])]}}]),model:{value:e.snack,callback:function(t){e.snack=t},expression:"snack"}},[e._v("\n    "+e._s(e.snackText)+"\n\n    ")])],1)}),[],!1,null,null,null);t.default=component.exports;l()(component,{VBtn:d.a,VCard:m.a,VCardSubtitle:h.b,VCardText:h.c,VCardTitle:h.d,VChip:f.a,VDataTable:v.a,VDialog:_.a,VEditDialog:k.a,VIcon:x.a,VSimpleCheckbox:y.a,VSnackbar:D.a,VSpacer:I.a,VTextField:S.a})}}]);